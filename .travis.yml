
install:
- wget http://www-us.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz
- tar xzf apache-maven-3.3.9-bin.tar.gz

before_script:
- rm $HOME/.m2/settings.xml
- export MAVEN_OPTS="-Dmaven.artifact.threads=3 -Xmx2469m -XX:MaxPermSize=512m"
- export PROJECTS="--projects !bundles/automation/org.eclipse.smarthome.automation.module.timer.test/pom.xml,!extensions/voice/org.eclipse.smarthome.voice.mactts/pom.xml,!bundles/automation/org.eclipse.smarthome.automation.module.script.test/pom.xml"

script:
- MAVEN_SKIP_RC=true apache-maven-3.3.9/bin/mvn install -fae -B $PROJECTS 2>&1 | ./filter.py ; test ${PIPESTATUS[0]} -eq 0

addons:
  apt:
    packages:
    - swig

sudo: required

dist: trusty

before_cache:
- rm -rf $HOME/.m2/repository/org/eclipse/smarthome/eclipsesmarthome-incubation
- rm -rf $HOME/.m2/repository/org/eclipse/smarthome/products

cache:
  directories:
  - $HOME/.m2

jdk:
- openjdk8

before_deploy:
- tar zcfv $TRAVIS_BUILD_DIR/m2repository.tar.gz -C $HOME/.m2/repository . 2>&1 | $TRAVIS_BUILD_DIR/filter.py

deploy:
  provider: releases
  api_key:
    secure: ElYrJFFGNHigzel0kGQ/jXzr4dGpJ3VJ9Kri7r9tHtJ7IK5ti7UYqkPfW6cze9/39xvn+X8bxc7pEpMmnEyAZvS5xo5NIp5jFdOOey+EvLOrKnN2WAJYOcrITsLLhb3AT/2iE8P0Qn3/DHgrCiixuLDXzw1jeYHO4IPxJZW3Ra7NHXwLwlJYvtMsHePr8Wp9lW0/QL8VMWfnnS6SppNFaW2VvKVIL4N7iqARxRZm/d28sIhuIzZRHfMnroDVf7LwKVV0caeunbDnsymyLDF06UtJfaNz/7F+Hf5KiZEIUyfSgLNit/2vAol8WcokZqNngAgRg224eniuKcRO7D6mbuMFljZg2ow8dY/Px/vRjYayPdm8A3SnC3He5IUg0a2QQObSUzOg8869wUCN+y6V0WHu0lMMTvrFOfrEJ2qY1deLtafuG4wN4ujeeq9xmIWUGIZdJMIcapO17Vn1XbCYZt5qqwvHs19y83seaPu4GvU36UyEGoO+Tm8ctLpWaCfZHqJaqJ8hlm1kAYwbsKqPD43ast5jR29uTL8VJUVOmuLKvt8UFg0VB2m5K8yBiKHeFsFS8oA4849JInohsfa9kB4MvVVajcD94kVYeUB4IOYIdRLs2bxh5O+MgGUhJ86/D6DDvohDhRyuxjGsEZ1W5GW77PxVpKu8JYtluVgPJXY=
  file:
  - m2repository.tar.gz
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-repo.zip
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-designer-win.zip
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-designer-win64.zip
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-designer-macosx64.zip
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-designer-linux.zip
  - distribution/target/eclipsesmarthome-incubation-0.8.0-SNAPSHOT-designer-linux64.zip
  skip_cleanup: true
  on:
    repo: mozilla/smarthome
    branch: master
    tags: true
